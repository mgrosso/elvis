Unable to create slave from backup of master
Created: 02/Nov/07 01:16 PM   Updated: 02/Nov/07 01:16 PM   
Return to search
Issue 8 of 29 issue(s)
<< Previous | BRUCE-22 | Next >>
Component/s:    Daemon
Affects Version/s:  1.0
Fix Version/s:  1.5

Time Tracking:  
Not Specified


 Description    « Hide
Problem: Backup includes bruce.slavesnapshotstatus.master_current_xaction APPLIED in master database. Daemon is unable to run after applying a master backup.

Workaround: Using the info in transactionlog, back out the master_current_xaction from the slave database.

<noformat>
bidb=# set search_path = bruce;
SET
bidb=# select * from slavesnapshotstatus ;
clusterid | slave_xaction | master_current_xaction | master_min_xaction | master_max_xaction | master_outstanding_xactions | update_time
---------------------------------------------------------------------------------------------------------------------------------------
2 | 687096477 | 2210901391 | 2210901391 | 2210901392 | 2210901391 | 2007-11-01 15:57:41.871426
3 | 1 | 687096508 | 687096506 | 687096509 | 687096506 | 2007-11-01 20:36:43.090537
(2 rows)

bidb=# select * from transactionlog where xaction = 687096508;
rowid | xaction | cmdtype | tabname | info
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
1514 | 687096508 | I | bipp.partnerportal_fact_20071101 | partnerportal_event_guid:int8:MTY4ODg0OTk3MTU2MjE2MA==:Unable to render embedded object: File () not found.|day_id:int4:MjQ5Ng==:Unable to render embedded object: File () not found.|seconds:int2:NDE=:Unable to render embedded object: File () not found.|ad_type_id:varchar:YmFubmVyMTI1eDEyNQ==:Unable to render embedded object: File () not found.|partner_id:int8:MTkwMDAwMDQ2OQ==:Unable to render embedded object: File () not found.|partner_adgroup_id:int4:MzI1MDE5:Unable to render embedded object: File () not found.|partner_page_placement_id:int4:MA==:Unable to render embedded object: File () not found.|payout_billing_line_item_id:int8:MTAwOTQ1:Unable to render embedded object: File () not found.|domain_id:int4:MA==:Unable to render embedded object: File () not found.|sub_partner:varchar::Unable to render embedded object: File () not found.:Unable to render embedded object: File () not found.|ad_tag_code:varchar:MDFFQjkwMUU3NTcxQ0QxNzVEQ0NDOTZCNTEyNTAxNTQ=:Unable to render embedded object: File () not found.:Unable to render embedded object: File () not found.:!|kitchen_sink_nvpairs:varchar:ZGF0ZT0yMDA3LTExLTAxKzE1JTNBNTglM0E0MSZpc19jb252ZXJzaW9uPTAmYWRfdGFnX2lkPTE4
: MzU0MDcmaXNfaW1wcmVzc2lvbj0wJkpTRVNTSU9OSUQ9Mzg0NTMyNDhGMDhGMkFFRUNENDdCRUMy
: RjBEN0Q5MTQmaXNfY2xpY2s9MSZjbGlja19kYXRlPTIwMDctMTEtMDErMTUlM0E1OCUzQTQxLjMz
: MiZmdWxsX2RvbWFpbl9pZD0wJnBhZ2VfcGF0aD1OQQ==:Unable to render embedded object: File () not found.:Unable to render embedded object: File () not found.|is_conversion_revoked:int2:MA==:Unable to render embedded object: File () not found.|potential_payout:int4:MzgwMA==:Unable to render embedded object: File () not found.|potential_cpa:int4:NDIwMA==:Unable to render embedded object: File () not found.|actual_payout:int4:!:!|actual_cpa:int4:!:!|revenue_revoked:int4:!:!|payout_id:int8:NDQzMzY3:Unable to render embedded object: File () not found.|impression_guid:int8:!:!|click_guid:int8:MTY4ODg0OTk3MTU2NDAxNw==:Unable to render embedded object: File () not found.|is_intl_flag:int2:MA==:Unable to render embedded object: File () not found.|browser_guid:int8:MTY4ODg0OTk3MTU2NDAxNg==:Unable to render embedded object: File () not found.|user_agent:varchar:TW96aWxsYS80LjAgKGNvbXBhdGlibGU7IE1TSUUgNi4wOyBXaW5kb3dzIE5UIDUuMTsgU1YxOyAu
: TkVUIENMUiAxLjEuNDMyMjsgLk5FVCBDTFIgMi4wLjUwNzI3KQ==:Unable to render embedded object: File () not found.|http_referring_domain_id:int4:MA==:Unable to render embedded object: File () not found.|http_method:varchar:R0VU:Unable to render embedded object: File () not found.|http_version:varchar:SFRUUC8xLjE=:Unable to render embedded object: File () not found.|x2:varchar:!:!|x3:varchar:!:!|x4:varchar:!:!|click_day_id:int4:MjQ5Ng==:Unable to render embedded object: File () not found.
(1 row)

bidb=# select decode('MTY4ODg0OTk3MTU2MjE2MA==','base64');
decode
------------------
1688849971562160
(1 row)

bidb=# select * from bipp.partnerportal_fact_20071101 where partnerportal_event_guid = 1688849971562160;
partnerportal_event_guid | event_type_id | day_id | time_id | seconds | account_manager_id | ad_type_id | ad_category_id | partner_id | partner_campaign_id | partner_adgroup_id | partner_site_section_id | partner_page_placement_id | ad_id | payout_billing_line_item_id | distribution_campaign_id | domain_id | nb_site_section_id | sub_partner | override_domain_id | is_blocked | ad_tag_code | partner_tracking_code | campaign_tracking_code | kitchen_sink_nvpairs | debug_nvpairs | is_click_converted | is_conversion_revoked | is_not_convertible | potential_payout | potential_max_payout | potential_cpa | potential_default_payout | actual_payout | actual_cpa | revenue_revoked | payout_id | ad_group_edit_id | impression_guid | click_guid | ip | is_intl_flag | ip_country | browser_guid | browser_guid_is_outbound | user_agent | http_referrer | http_referring_domain_id | referring_ip | http_method | http_uri | http_version | x1 | x2 | x3 | x4 | click_day_id | event_count
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------
1688849971562160 | 2 | 2496 | 958 | 41 | 6673 | banner125x125 | banner | 1900000469 | 1140 | 325019 | 0 | 0 | 19027 | 100945 | 1750 | 0 | 0 | | | 1 | 01EB901E7571CD175DCCC96B51250154 | | | date=2007-11-01+15%3A58%3A41&is_conversion=0&ad_tag_id=1835407&is_impression=0&JSESSIONID=38453248F08F2AEECD47BEC2F0D7D914&is_click=1&click_date=2007-11-01+15%3A58%3A41.332&full_domain_id=0&page_path=NA | | 0 | 0 | 0 | 3800 | 3650 | 4200 | 3000 | | | | 443367 | 10780 | | 1688849971564017 | 198.151.35.6 | 0 | US | 1688849971564016 | 1 | Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727) | NA | 0 | 0.0.0.0 | GET | /r/01EB901E7571CD175DCCC96B51250154 | HTTP/1.1 | 4239871 | | | | 2496 | 1
(1 row)

<noformat>

 Description    
   Problem: Backup includes bruce.slavesnapshotstatus.master_current_xaction APPLIED in master database. Daemon is unable to run after applying a master backup. Workaround: Using the info in transactionlog, back out the master_current_xaction from the slave database. <noformat> bidb=# set search_path = bruce; SET bidb=# select * from slavesnapshotstatus ; clusterid | slave_xaction | master_current_xaction | master_min_xaction | master_max_xaction | master_outstanding_xactions | update_time --------------------------------------------------------------------------------------------------------------------------------------- 2 | 687096477 | 2210901391 | 2210901391 | 2210901392 | 2210901391 | 2007-11-01 15:57:41.871426 3 | 1 | 687096508 | 687096506 | 687096509 | 687096506 | 2007-11-01 20:36:43.090537 (2 rows) bidb=# select * from transactionlog where xaction = 687096508; rowid | xaction | cmdtype | tabname | info ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1514 | 687096508 | I | bipp.partnerportal_fact_20071101 | partnerportal_event_guid:int8:MTY4ODg0OTk3MTU2MjE2MA==:Unable to render embedded object: File () not found.|day_id:int4:MjQ5Ng==:Unable to render embedded object: File () not found.|seconds:int2:NDE=:Unable to render embedded object: File () not found.|ad_type_id:varchar:YmFubmVyMTI1eDEyNQ==:Unable to render embedded object: File () not found.|partner_id:int8:MTkwMDAwMDQ2OQ==:Unable to render embedded object: File () not found.|partner_adgroup_id:int4:MzI1MDE5:Unable to render embedded object: File () not found.|partner_page_placement_id:int4:MA==:Unable to render embedded object: File () not found.|payout_billing_line_item_id:int8:MTAwOTQ1:Unable to render embedded object: File () not found.|domain_id:int4:MA==:Unable to render embedded object: File () not found.|sub_partner:varchar::Unable to render embedded object: File () not found.:Unable to render embedded object: File () not found.|ad_tag_code:varchar:MDFFQjkwMUU3NTcxQ0QxNzVEQ0NDOTZCNTEyNTAxNTQ=:Unable to render embedded object: File () not found.:Unable to render embedded object: File () not found.:!|kitchen_sink_nvpairs:varchar:ZGF0ZT0yMDA3LTExLTAxKzE1JTNBNTglM0E0MSZpc19jb252ZXJzaW9uPTAmYWRfdGFnX2lkPTE4 : MzU0MDcmaXNfaW1wcmVzc2lvbj0wJkpTRVNTSU9OSUQ9Mzg0NTMyNDhGMDhGMkFFRUNENDdCRUMy : RjBEN0Q5MTQmaXNfY2xpY2s9MSZjbGlja19kYXRlPTIwMDctMTEtMDErMTUlM0E1OCUzQTQxLjMz : MiZmdWxsX2RvbWFpbl9pZD0wJnBhZ2VfcGF0aD1OQQ==:Unable to render embedded object: File () not found.:Unable to render embedded object: File () not found.|is_conversion_revoked:int2:MA==:Unable to render embedded object: File () not found.|potential_payout:int4:MzgwMA==:Unable to render embedded object: File () not found.|potential_cpa:int4:NDIwMA==:Unable to render embedded object: File () not found.|actual_payout:int4:!:!|actual_cpa:int4:!:!|revenue_revoked:int4:!:!|payout_id:int8:NDQzMzY3:Unable to render embedded object: File () not found.|impression_guid:int8:!:!|click_guid:int8:MTY4ODg0OTk3MTU2NDAxNw==:Unable to render embedded object: File () not found.|is_intl_flag:int2:MA==:Unable to render embedded object: File () not found.|browser_guid:int8:MTY4ODg0OTk3MTU2NDAxNg==:Unable to render embedded object: File () not found.|user_agent:varchar:TW96aWxsYS80LjAgKGNvbXBhdGlibGU7IE1TSUUgNi4wOyBXaW5kb3dzIE5UIDUuMTsgU1YxOyAu : TkVUIENMUiAxLjEuNDMyMjsgLk5FVCBDTFIgMi4wLjUwNzI3KQ==:Unable to render embedded object: File () not found.|http_referring_domain_id:int4:MA==:Unable to render embedded object: File () not found.|http_method:varchar:R0VU:Unable to render embedded object: File () not found.|http_version:varchar:SFRUUC8xLjE=:Unable to render embedded object: File () not found.|x2:varchar:!:!|x3:varchar:!:!|x4:varchar:!:!|click_day_id:int4:MjQ5Ng==:Unable to render embedded object: File () not found. (1 row) bidb=# select decode('MTY4ODg0OTk3MTU2MjE2MA==','base64'); decode ------------------ 1688849971562160 (1 row) bidb=# select * from bipp.partnerportal_fact_20071101 where partnerportal_event_guid = 1688849971562160; partnerportal_event_guid | event_type_id | day_id | time_id | seconds | account_manager_id | ad_type_id | ad_category_id | partner_id | partner_campaign_id | partner_adgroup_id | partner_site_section_id | partner_page_placement_id | ad_id | payout_billing_line_item_id | distribution_campaign_id | domain_id | nb_site_section_id | sub_partner | override_domain_id | is_blocked | ad_tag_code | partner_tracking_code | campaign_tracking_code | kitchen_sink_nvpairs | debug_nvpairs | is_click_converted | is_conversion_revoked | is_not_convertible | potential_payout | potential_max_payout | potential_cpa | potential_default_payout | actual_payout | actual_cpa | revenue_revoked | payout_id | ad_group_edit_id | impression_guid | click_guid | ip | is_intl_flag | ip_country | browser_guid | browser_guid_is_outbound | user_agent | http_referrer | http_referring_domain_id | referring_ip | http_method | http_uri | http_version | x1 | x2 | x3 | x4 | click_day_id | event_count ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------ 1688849971562160 | 2 | 2496 | 958 | 41 | 6673 | banner125x125 | banner | 1900000469 | 1140 | 325019 | 0 | 0 | 19027 | 100945 | 1750 | 0 | 0 | | | 1 | 01EB901E7571CD175DCCC96B51250154 | | | date=2007-11-01+15%3A58%3A41&is_conversion=0&ad_tag_id=1835407&is_impression=0&JSESSIONID=38453248F08F2AEECD47BEC2F0D7D914&is_click=1&click_date=2007-11-01+15%3A58%3A41.332&full_domain_id=0&page_path=NA | | 0 | 0 | 0 | 3800 | 3650 | 4200 | 3000 | | | | 443367 | 10780 | | 1688849971564017 | 198.151.35.6 | 0 | US | 1688849971564016 | 1 | Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727) | NA | 0 | 0.0.0.0 | GET | /r/01EB901E7571CD175DCCC96B51250154 | HTTP/1.1 | 4239871 | | | | 2496 | 1 (1 row) <noformat>
    Show »

